# 테스트 시나리오: 플랫폼 연동 및 플레이리스트 저장

**기능**: 2.3 플랫폼 연동  
**작성자**: Taylor FE TEST  
**작성 일시**: 2024년  
**기반**: `user_scenarios/feature_platform_integration.md`

---

## 테스트 목표

플랫폼 연동 및 플레이리스트 저장 기능의 모든 유저 시나리오를 검증하여 다음을 확인:
- Spotify/YouTube Music/Apple Music 연동 정상 동작
- 플레이리스트 저장 정상 동작
- 곡 매칭 알고리즘 정상 동작
- 모든 엣지 케이스 적절히 처리

---

## 테스트 케이스

### TC-PLATFORM-001: 편지 받은 사용자가 플레이리스트 저장 (Spotify)

**시나리오**: 편지를 받은 사용자가 Spotify에 플레이리스트 저장

**Given**:
- 사용자가 편지를 받음 (링크를 통해 접근)
- 사용자는 Spotify 계정을 보유하고 있음
- 사용자는 편지를 열람함

**When**:
1. "내 플랫폼에 저장" 버튼 클릭
2. "Spotify" 선택
3. Spotify 로그인 (처음 사용 시)
4. 권한 승인 완료
5. 플레이리스트 저장 진행

**Then**:
- 플레이리스트가 Spotify에 생성됨
- 편지의 모든 곡이 플레이리스트에 포함됨
- "저장 완료" 메시지 표시
- Spotify 링크 제공

**검증 포인트**:
- Spotify OAuth 인증 정상
- 플레이리스트 생성 API 호출 정상
- 저장 완료 시간 10초 이내
- 저장 성공률 60% 이상

---

### TC-PLATFORM-002: 편지 받은 사용자가 플레이리스트 저장 (YouTube Music)

**시나리오**: 편지를 받은 사용자가 YouTube Music에 플레이리스트 저장

**Given**:
- 사용자가 편지를 받음
- 사용자는 YouTube Music 계정을 보유하고 있음

**When**:
1. "내 플랫폼에 저장" 버튼 클릭
2. "YouTube Music" 선택
3. Google 계정으로 로그인
4. 권한 승인 완료
5. 플레이리스트 저장 진행

**Then**:
- 플레이리스트가 YouTube Music에 생성됨
- 편지의 모든 곡이 플레이리스트에 포함됨

**검증 포인트**:
- YouTube Music API 연동 정상
- 플레이리스트 생성 정상

---

### TC-PLATFORM-003: 편지 받은 사용자가 플레이리스트 저장 (Apple Music)

**시나리오**: 편지를 받은 사용자가 Apple Music에 플레이리스트 저장

**Given**:
- 사용자가 편지를 받음
- 사용자는 Apple Music 계정을 보유하고 있음
- 사용자는 iOS/Safari 브라우저를 사용함

**When**:
1. "내 플랫폼에 저장" 버튼 클릭
2. "Apple Music" 선택
3. Apple ID로 로그인
4. 권한 승인 완료
5. 플레이리스트 저장 진행

**Then**:
- 플레이리스트가 Apple Music에 생성됨
- 편지의 모든 곡이 플레이리스트에 포함됨

**검증 포인트**:
- Apple MusicKit JS 정상 동작
- 플레이리스트 생성 정상

---

### TC-PLATFORM-004: 곡 매칭 실패 처리

**시나리오**: 일부 곡이 플랫폼에서 찾을 수 없음

**Given**:
- 사용자가 편지를 받음
- 사용자가 플랫폼에 저장을 시도함
- 편지에 포함된 곡 중 일부가 선택한 플랫폼에 없음

**When**:
1. "내 플랫폼에 저장" 버튼 클릭
2. 플랫폼 선택하고 저장 진행
3. 곡 매칭 과정에서 일부 곡이 매칭되지 않음

**Then**:
- 매칭된 곡들은 플레이리스트에 저장됨
- 매칭 실패한 곡 목록 표시
- "X곡이 저장되었습니다. Y곡은 찾을 수 없습니다" 메시지 표시

**검증 포인트**:
- 부분 매칭 처리 정상
- 사용자에게 명확한 피드백 제공

---

### TC-PLATFORM-005: 이미 로그인한 사용자의 플레이리스트 저장

**시나리오**: 이전에 로그인한 사용자가 빠르게 저장

**Given**:
- 사용자가 이전에 플랫폼에 로그인한 적이 있음
- 사용자가 편지를 받음

**When**:
1. "내 플랫폼에 저장" 버튼 클릭
2. 이전에 사용한 플랫폼이 자동 선택됨
3. 추가 로그인 없이 저장 진행

**Then**:
- 플레이리스트가 즉시 저장됨
- 로그인 과정 없이 저장 완료됨

**검증 포인트**:
- 세션 유지 정상
- 저장 시간 단축

---

## 엣지 케이스 테스트

### TC-PLATFORM-E001: 플랫폼 로그인 실패

**시나리오**: 플랫폼 로그인 중 오류 발생

**Given**: 사용자가 플랫폼 로그인을 시도함

**When**: 로그인이 실패함 (네트워크 오류, 계정 오류 등)

**Then**:
- "로그인에 실패했습니다" 메시지 표시
- 재시도 버튼 제공
- 다른 플랫폼 선택 가능

**검증 포인트**:
- 에러 핸들링 정상
- 사용자 피드백 명확

---

### TC-PLATFORM-E002: 권한 승인 거부

**시나리오**: 사용자가 권한 승인을 거부함

**Given**: 사용자가 플랫폼 로그인을 완료함

**When**: 권한 승인을 거부함

**Then**:
- "권한이 필요합니다" 메시지 표시
- 권한 승인 방법 안내
- 다른 플랫폼 선택 가능

**검증 포인트**:
- 권한 거부 처리 정상
- 사용자 가이드 제공

---

### TC-PLATFORM-E003: 모든 곡 매칭 실패

**시나리오**: 편지의 모든 곡이 플랫폼에서 찾을 수 없음

**Given**: 사용자가 플레이리스트 저장을 시도함

**When**: 편지의 모든 곡이 플랫폼에서 찾을 수 없음

**Then**:
- "저장할 수 있는 곡이 없습니다" 메시지 표시
- 다른 플랫폼을 시도하도록 안내

**검증 포인트**:
- 전체 실패 처리 정상
- 대안 제시

---

### TC-PLATFORM-E004: 저장 중 네트워크 오류

**시나리오**: 플레이리스트 저장 중 네트워크 오류 발생

**Given**: 사용자가 플레이리스트 저장을 진행함

**When**: 저장 중 네트워크 오류가 발생함

**Then**:
- "저장에 실패했습니다" 메시지 표시
- 재시도 버튼 제공
- 부분 저장된 곡은 유지됨

**검증 포인트**:
- 네트워크 오류 처리 정상
- 재시도 기능 제공

---

## 테스트 커버리지 목표

- **단위 테스트**: 80% 이상
- **통합 테스트**: 주요 플로우 100%
- **엣지 케이스**: 모든 엣지 케이스 테스트

---

## 테스트 우선순위

- **P0 (필수)**: TC-PLATFORM-001, TC-PLATFORM-004
- **P1 (중요)**: TC-PLATFORM-002, TC-PLATFORM-003, TC-PLATFORM-005, 모든 엣지 케이스

---

## 다음 단계

1. 단위 테스트 작성 (RED)
2. 통합 테스트 작성
3. E2E 테스트 작성

