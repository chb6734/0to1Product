# 테스트 시나리오: 편지 전송 및 수신

**기능**: 2.4 편지 전송 및 수신  
**작성자**: Taylor FE TEST  
**작성 일시**: 2024년  
**기반**: `user_scenarios/feature_letter_send_receive.md`

---

## 테스트 목표

편지 전송 및 수신 기능의 모든 유저 시나리오를 검증하여 다음을 확인:
- 편지 전송 (이메일/링크 공유) 정상 동작
- 편지 열람 정상 동작
- 편지 보관함 관리 정상 동작
- 모든 엣지 케이스 적절히 처리

---

## 테스트 케이스

### TC-SEND-001: 편지 전송 (이메일)

**시나리오**: 사용자가 이메일로 편지를 전송함

**Given**:
- 사용자가 편지 생성을 완료함
- 사용자는 수신자의 이메일 주소를 알고 있음

**When**:
1. "전송하기" 버튼 클릭
2. "이메일로 전송" 선택
3. 수신자 이메일 주소 입력 (예: "recipient@example.com")
4. "전송" 버튼 클릭

**Then**:
- 편지가 수신자에게 이메일로 전송됨
- "전송 완료" 메시지 표시
- 편지가 "보낸 편지" 보관함에 저장됨
- 수신자가 이메일을 받음

**검증 포인트**:
- 이메일 전송 API 정상 동작
- 보관함 저장 정상
- 편지 열람률 70% 이상

---

### TC-SEND-002: 편지 전송 (링크 공유)

**시나리오**: 사용자가 링크를 복사하여 공유함

**Given**:
- 사용자가 편지 생성을 완료함

**When**:
1. "전송하기" 버튼 클릭
2. "링크 공유" 선택
3. "링크 복사" 버튼 클릭
4. 링크가 클립보드에 복사됨
5. 카카오톡/문자/SNS에 링크 붙여넣기

**Then**:
- 편지 링크가 생성됨
- 링크가 클립보드에 복사됨
- 편지가 "보낸 편지" 보관함에 저장됨
- 수신자가 링크를 클릭하여 편지를 열람할 수 있음

**검증 포인트**:
- 링크 생성 정상
- 클립보드 복사 정상
- 링크 접근 정상

---

### TC-SEND-003: 편지 열람 (링크를 통한 접근)

**시나리오**: 사용자가 링크를 통해 편지를 열람함

**Given**:
- 사용자가 편지 링크를 받음
- 사용자는 로그인하지 않은 상태임

**When**:
1. 편지 링크 클릭
2. 편지 열람 페이지 열림
3. 편지 확인
4. 곡 재생 (선택적)
5. "내 플랫폼에 저장" 버튼 클릭 (선택적)

**Then**:
- 편지가 카드 형태로 표시됨
- 모바일에서 최적화되어 표시됨
- 로그인 없이 편지를 열람할 수 있음
- 편지가 "받은 편지" 보관함에 저장됨 (로그인 시)

**검증 포인트**:
- 링크 접근 정상
- 반응형 디자인 정상
- 비로그인 사용자 접근 정상
- 편지 열람률 70% 이상

---

### TC-SEND-004: 받은 편지 보관함 확인

**시나리오**: 사용자가 받은 편지 보관함을 확인함

**Given**:
- 사용자가 로그인되어 있음
- 사용자가 이전에 편지를 받은 적이 있음

**When**:
1. "받은 편지" 탭 클릭
2. 받은 편지 목록 확인
3. 특정 편지 클릭

**Then**:
- 받은 편지 목록이 날짜별로 정렬되어 표시됨
- 최신 편지가 위에 표시됨
- 편지 제목, 보낸 사람, 날짜가 표시됨
- 편지를 클릭하면 상세 내용이 표시됨

**검증 포인트**:
- 목록 조회 정상
- 날짜별 정렬 정상
- 상세 화면 이동 정상

---

### TC-SEND-005: 보낸 편지 보관함 확인

**시나리오**: 사용자가 보낸 편지 보관함을 확인함

**Given**:
- 사용자가 로그인되어 있음
- 사용자가 이전에 편지를 보낸 적이 있음

**When**:
1. "보낸 편지" 탭 클릭
2. 보낸 편지 목록 확인
3. 특정 편지 클릭

**Then**:
- 보낸 편지 목록이 날짜별로 정렬되어 표시됨
- 최신 편지가 위에 표시됨
- 편지 제목, 수신자, 날짜가 표시됨
- 편지를 클릭하면 상세 내용이 표시됨

**검증 포인트**:
- 목록 조회 정상
- 날짜별 정렬 정상
- 상세 화면 이동 정상

---

### TC-SEND-006: 편지 검색

**시나리오**: 사용자가 편지를 검색함

**Given**:
- 사용자가 로그인되어 있음
- 사용자가 받은 편지 또는 보낸 편지 보관함에 있음

**When**:
1. 검색창에 검색어 입력 (보낸 사람 이름 또는 곡 제목)
2. 검색 결과 확인
3. 검색 결과에서 원하는 편지 클릭

**Then**:
- 검색어와 일치하는 편지가 표시됨
- 검색 결과가 하이라이트됨
- 편지를 클릭하면 상세 내용이 표시됨

**검증 포인트**:
- 검색 기능 정상
- 실시간 필터링 정상
- 하이라이트 표시 정상

---

## 엣지 케이스 테스트

### TC-SEND-E001: 잘못된 이메일 주소 입력

**시나리오**: 사용자가 잘못된 형식의 이메일 주소를 입력함

**Given**: 사용자가 편지를 전송하려고 함

**When**: 잘못된 형식의 이메일 주소를 입력함 (예: "invalid-email")

**Then**:
- "올바른 이메일 주소를 입력해주세요" 에러 메시지 표시
- 전송 버튼이 비활성화됨

**검증 포인트**:
- 이메일 형식 검증 정상
- 실시간 검증 (debounce 적용)

---

### TC-SEND-E002: 편지 링크 만료

**시나리오**: 사용자가 만료된 편지 링크를 클릭함

**Given**: 사용자가 오래된 편지 링크를 클릭함

**When**: 편지 링크가 만료됨 (예: 1년 경과)

**Then**:
- "만료된 편지입니다" 메시지 표시
- 보낸 사람에게 새 링크를 요청하도록 안내

**검증 포인트**:
- 링크 만료 처리 정상
- 사용자 안내 명확

---

### TC-SEND-E003: 편지 열람 실패 (네트워크 오류)

**시나리오**: 편지 열람 중 네트워크 오류 발생

**Given**: 사용자가 편지 링크를 클릭함

**When**: 네트워크 오류가 발생함

**Then**:
- "연결에 실패했습니다" 메시지 표시
- 재시도 버튼 제공

**검증 포인트**:
- 네트워크 오류 처리 정상
- 재시도 기능 제공

---

### TC-SEND-E004: 검색 결과 없음

**시나리오**: 검색어와 일치하는 편지가 없음

**Given**: 사용자가 편지를 검색함

**When**: 검색어와 일치하는 편지가 없음

**Then**:
- "검색 결과가 없습니다" 메시지 표시
- 다른 검색어를 시도하도록 안내

**검증 포인트**:
- 빈 결과 처리 정상
- 사용자 안내 제공

---

### TC-SEND-E005: 편지 전송 실패

**시나리오**: 편지 전송 중 오류 발생

**Given**: 사용자가 편지를 전송하려고 함

**When**: 전송 중 오류가 발생함 (서버 오류, 이메일 전송 실패 등)

**Then**:
- "전송에 실패했습니다" 메시지 표시
- 재시도 버튼 제공
- 링크 공유 방법이 대안으로 제시됨

**검증 포인트**:
- 전송 실패 처리 정상
- 재시도 기능 제공
- 대안 제시

---

## 테스트 커버리지 목표

- **단위 테스트**: 80% 이상
- **통합 테스트**: 주요 플로우 100%
- **엣지 케이스**: 모든 엣지 케이스 테스트

---

## 테스트 우선순위

- **P0 (필수)**: TC-SEND-001, TC-SEND-002, TC-SEND-003, TC-SEND-E001
- **P1 (중요)**: TC-SEND-004, TC-SEND-005, TC-SEND-006, 나머지 엣지 케이스

---

## 다음 단계

1. 단위 테스트 작성 (RED)
2. 통합 테스트 작성
3. E2E 테스트 작성

