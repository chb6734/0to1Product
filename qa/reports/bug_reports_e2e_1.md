# QA 버그 리포트: 온보딩 페이지 접근 시 리다이렉트 문제

**작성자**: Quinn QA  
**일시**: 2024년  
**우선순위**: High  
**상태**: 발견됨

---

## 🐛 버그 요약

온보딩 페이지(`/onboarding`)로 직접 접근 시, 인증되지 않은 사용자로 간주되어 로그인 페이지(`/login`)로 리다이렉트됩니다.

---

## 📋 재현 단계

1. 브라우저에서 `/onboarding` 페이지로 직접 이동
2. 페이지가 로드됨
3. 즉시 `/login` 페이지로 리다이렉트됨

**테스트 코드**:
```typescript
test('TC-AUTH-E003: 닉네임 미입력 검증', async ({ page }) => {
  await page.goto('/onboarding');
  // ❌ 실패: 닉네임 입력 필드를 찾을 수 없음
  const nicknameInput = page.getByLabel(/닉네임/i);
  await expect(nicknameInput).toBeVisible();
});
```

---

## 🔍 예상 동작

E2E 테스트에서 온보딩 페이지로 직접 이동할 수 있어야 합니다. 테스트 환경에서는 Mock 인증 상태를 사용하여 온보딩 페이지에 접근할 수 있어야 합니다.

---

## 🔍 실제 동작

온보딩 페이지로 직접 이동하면:
1. `useAuth` 훅이 `isAuthenticated`를 `false`로 판단
2. `useEffect`에서 `/login`으로 리다이렉트
3. 온보딩 페이지 UI가 렌더링되지 않음

---

## 💡 원인 분석

**문제점**:
- `onboarding/page.tsx`의 `useEffect`가 `isAuthenticated`를 확인하여 리다이렉트
- E2E 테스트에서 Mock 인증 상태를 설정해도, React 컴포넌트가 마운트되기 전에 리다이렉트 발생
- `useAuth` 훅이 localStorage에서 상태를 복원하는데 시간이 걸림

**영향**:
- E2E 테스트에서 온보딩 페이지 테스트 불가
- 실제 사용자 플로우에서는 정상 동작 (OAuth 콜백 후 온보딩 페이지로 이동)

---

## 🔧 해결 방안 제안

### 옵션 1: 테스트용 인증 상태 설정 개선
- Playwright에서 localStorage 설정을 페이지 로드 전에 완료
- `page.addInitScript`를 사용하여 초기 상태 설정

### 옵션 2: 온보딩 페이지 접근 조건 완화
- 테스트 환경에서는 인증 체크를 완화
- 또는 테스트용 쿼리 파라미터 추가

### 옵션 3: E2E 테스트 플로우 변경
- 로그인 → 온보딩 플로우를 전체적으로 테스트
- 단위 테스트는 별도로 작성

---

## 📊 테스트 결과

**실패한 테스트**:
1. `TC-AUTH-E003: 닉네임 미입력 검증` ❌
2. `온보딩 페이지 UI 요소 확인` ❌

**성공한 테스트**:
1. `로그인 페이지 UI 요소 확인` ✅
2. `TC-AUTH-001: 신규 사용자 가입 (Google 소셜 로그인)` ✅ (버튼 클릭까지)
3. `TC-AUTH-002: 신규 사용자 가입 (Kakao 소셜 로그인)` ✅
4. `TC-AUTH-003: 신규 사용자 가입 (Apple 소셜 로그인)` ✅
5. `닉네임 길이 제한 검증` ✅ (다른 방법으로 테스트 필요)

---

## 🎯 다음 단계

1. FE Engineer에게 버그 리포트 전달
2. FE Engineer가 수정 방안 결정 및 구현
3. QA가 재테스트 수행
4. 모든 테스트 통과 시 완료

---

## 📝 참고

- 실제 사용자 플로우에서는 문제 없음 (OAuth 콜백 후 온보딩 페이지로 이동)
- E2E 테스트 환경에서만 발생하는 문제
- 테스트 가능성을 높이기 위한 개선 필요

