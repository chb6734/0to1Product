# PM 인증 보안 요구사항 검토 대화

**참여자**: Athena PM  
**작성 일시**: 2024년  
**목적**: 인증 토큰 저장 방식 보안 요구사항 검토 및 PRD 보완

---

## 문제 인식

사용자가 "PRD에 로그인하면 그 데이터 쿠키에 저장되어야 하는거 아냐?"라고 질문했습니다.

현재 상황을 확인한 결과:

### 현재 구현 상태
- `useAuth` 훅에서 **localStorage**를 사용하여 사용자 정보 저장
- 인증 토큰이 localStorage에 저장되고 있음
- 보안 취약점 존재 가능성

### PRD v4 현황
- 보안 요구사항에는 "소셜 로그인 OAuth 2.0", "사용자 데이터 암호화" 등이 명시되어 있음
- 하지만 **인증 토큰/세션 저장 방식**에 대한 명시적 요구사항이 없음

---

## 보안 관점 분석

### localStorage vs httpOnly 쿠키

| 항목 | localStorage | httpOnly 쿠키 |
|------|--------------|---------------|
| **XSS 공격 방지** | ❌ JavaScript로 접근 가능 | ✅ JavaScript로 접근 불가능 |
| **CSRF 공격 방지** | ⚠️ 자동 전송 안 됨 | ✅ SameSite 설정 가능 |
| **자동 전송** | ❌ 수동으로 헤더에 추가 필요 | ✅ 모든 요청에 자동 포함 |
| **만료 관리** | ❌ 클라이언트 측 관리 | ✅ 서버 측 관리 가능 |

### 보안 권장사항

**인증 토큰 저장**:
- ✅ **httpOnly 쿠키 사용** (XSS 공격 방지)
- ❌ localStorage에 토큰 저장 금지

**사용자 프로필 정보**:
- ✅ UI 표시용 정보(nickname, profileImage 등)는 localStorage 사용 가능
- ❌ 민감한 정보(토큰, 세션 ID)는 절대 localStorage에 저장하지 않음

---

## PRD 보완 사항

PRD v4에 다음 내용을 추가했습니다:

### 7. 보안 요구사항 (보완)

#### 7.1 인증 및 세션 관리

**인증 토큰 저장 방식**:
- ✅ **httpOnly 쿠키 사용** (XSS 공격 방지)
- ❌ localStorage에 토큰 저장 금지 (보안 취약점)

**세션 관리**:
- Supabase Auth의 기본 세션 관리 활용
- 서버 측에서 세션 만료 시간 관리
- 자동 로그아웃 기능 (세션 만료 시)

**사용자 프로필 정보**:
- UI 표시용 정보(nickname, profileImage 등)는 localStorage 사용 가능
- 민감한 정보(토큰, 세션 ID)는 절대 localStorage에 저장하지 않음

**보안 헤더**:
- HTTPS 필수
- SameSite 쿠키 설정 (CSRF 공격 방지)
- Secure 쿠키 설정 (HTTPS에서만 전송)

---

## 다음 단계

1. **TPM과 협의 필요**: 
   - Supabase Auth의 기본 동작 확인
   - 쿠키 기반 세션 관리 구현 방안 검토
   - localStorage 사용 범위 명확화

2. **FE Engineer와 협의 필요**:
   - 현재 `useAuth` 훅의 localStorage 사용 방식 검토
   - httpOnly 쿠키 기반으로 전환 시 영향 범위 파악
   - 마이그레이션 계획 수립

3. **우선순위 결정**:
   - P0 (보안 취약점): 즉시 수정 필요
   - P1 (보안 강화): 단계적 개선

---

**작성 완료일**: 2024년  
**다음 단계**: TPM과 협의하여 기술적 구현 방안 확정

