# FE TEST ↔ PM: P1 기능 요구사항 확인

**작성자**: Taylor FE TEST  
**작성 일시**: 2024년  
**목적**: P1 기능들의 상세 요구사항 확인

---

## 🧪 FE TEST → PM

안녕하세요, Athena PM님. P1 기능들에 대한 테스트 코드를 작성하기 전에 각 기능의 상세 요구사항을 확인하고 싶습니다.

P1 기능들은 다음과 같습니다:
1. 곡 검색 자동완성
2. 정렬/필터 기능
3. 임시 저장
4. 플랫폼 자동 선택 고도화

각 기능에 대해 다음을 확인하고 싶습니다:

### 1. 곡 검색 자동완성
- 검색어 입력 시 몇 글자부터 자동완성이 시작되나요? (예: 2글자 이상)
- 자동완성 결과는 최대 몇 개까지 표시되나요?
- debounce 시간은 얼마인가요? (현재 검색은 300ms)
- 자동완성 결과를 클릭하면 어떻게 동작하나요? (검색 결과로 이동? 바로 추가?)

### 2. 정렬/필터 기능
- 보관함에서 어떤 정렬 옵션이 필요한가요?
  - 날짜순 (최신순/오래된순)
  - 곡 수순 (많은순/적은순)
  - 재생 횟수순
- 필터 옵션은 무엇인가요?
  - 보낸 사람/수신자 이름
  - 곡 제목
  - 날짜 범위
- 정렬/필터는 받은 편지와 보낸 편지 모두에 적용되나요?

### 3. 임시 저장
- 언제 임시 저장이 실행되나요? (곡 추가/삭제, 메시지 입력 시?)
- debounce 시간은 얼마인가요? (1초?)
- 저장 위치는 어디인가요? (localStorage? 서버?)
- 편지 생성 페이지 재진입 시 자동으로 복구되나요?
- 복구 모달/알림이 필요한가요?

### 4. 플랫폼 자동 선택 고도화
- 현재 기본 플랫폼 설정은 있지만, "고도화"는 어떤 기능을 의미하나요?
  - 곡별 플랫폼 자동 감지?
  - 사용자 이전 선택 패턴 학습?
  - 스마트 플랫폼 추천?
- 어떤 방식으로 구현되나요?

각 기능의 사용자 시나리오도 함께 알려주시면 테스트 작성에 도움이 될 것 같습니다.

---

## 🧭 PM → FE TEST

안녕하세요, Taylor FE TEST님. P1 기능들의 상세 요구사항을 정리해드리겠습니다.

### 1. 곡 검색 자동완성

**요구사항**:
- 검색어 입력 시 **2글자 이상**부터 자동완성 시작
- 자동완성 결과는 **최대 5개**까지 표시
- debounce 시간: **300ms** (기존 검색과 동일)
- 자동완성 결과 클릭 시: **해당 검색어로 검색 결과 페이지로 이동** (바로 추가 X)

**사용자 시나리오**:
- 사용자가 검색창에 "겨울"을 입력
- "겨울 노래", "겨울밤", "겨울왕국" 등 자동완성 제안 표시
- 사용자가 "겨울 노래" 클릭
- "겨울 노래"로 검색 결과 표시

**엣지 케이스**:
- 1글자 입력 시 자동완성 미표시
- 검색어가 없을 때 자동완성 미표시
- 네트워크 오류 시 자동완성 미표시

### 2. 정렬/필터 기능

**요구사항**:
- 정렬 옵션:
  - 날짜순 (최신순/오래된순) - 기본값: 최신순
  - 곡 수순 (많은순/적은순)
  - 재생 횟수순 (많은순/적은순)
- 필터 옵션:
  - 보낸 사람/수신자 이름 (받은 편지: 보낸 사람, 보낸 편지: 수신자)
  - 곡 제목 (편지에 포함된 곡 제목)
  - 날짜 범위 (시작일 ~ 종료일)
- 정렬/필터는 **받은 편지와 보낸 편지 모두에 적용**
- 정렬/필터 상태는 URL 쿼리 파라미터로 관리 (공유 가능)

**사용자 시나리오**:
- 사용자가 보관함에서 "정렬" 버튼 클릭
- "최신순", "오래된순", "곡 수 많은순" 등 선택
- 편지 목록이 선택한 정렬 기준으로 재정렬됨
- 필터 버튼 클릭하여 "보낸 사람: 김철수" 선택
- 해당 필터에 맞는 편지만 표시됨

**엣지 케이스**:
- 필터 결과가 없을 때 빈 상태 표시
- 정렬/필터 조합 시 올바른 결과 표시

### 3. 임시 저장

**요구사항**:
- 저장 시점:
  - 곡 추가/삭제 시
  - 메시지 입력 시 (debounce 1초)
- 저장 위치: **localStorage** (서버 저장은 P2)
- 저장 키: `fanstage_letter_draft`
- 편지 생성 페이지 재진입 시:
  - localStorage에 임시 저장 데이터가 있으면 **자동으로 복구**
  - 복구 모달 표시: "이전에 작성하던 편지가 있습니다. 복구하시겠습니까?"
  - 사용자가 "복구" 선택 시 데이터 로드
  - 사용자가 "새로 작성" 선택 시 데이터 삭제

**사용자 시나리오**:
- 사용자가 편지를 작성 중 (곡 3개 추가, 메시지 입력 중)
- 브라우저를 닫거나 다른 페이지로 이동
- 다시 편지 생성 페이지로 돌아옴
- "이전에 작성하던 편지가 있습니다" 모달 표시
- "복구" 클릭 시 이전 데이터 복구

**엣지 케이스**:
- 편지 완성 후 임시 저장 데이터 삭제
- 데모 모드에서는 임시 저장 사용 안 함 (기존 데모 모드 로직 사용)

### 4. 플랫폼 자동 선택 고도화

**요구사항**:
- 곡별 플랫폼 자동 감지:
  - 편지에 포함된 곡들의 플랫폼을 분석
  - 가장 많이 사용된 플랫폼을 기본값으로 추천
- 사용자 이전 선택 패턴 학습:
  - 사용자가 이전에 선택한 플랫폼 기록
  - 가장 자주 선택한 플랫폼을 기본값으로 사용
- 스마트 플랫폼 추천:
  - 편지의 곡들이 모두 특정 플랫폼에 있으면 해당 플랫폼 추천
  - 여러 플랫폼에 분산되어 있으면 사용자의 기본 플랫폼 사용

**사용자 시나리오**:
- 사용자가 편지를 생성 (Spotify 곡 5개, Apple Music 곡 1개)
- "전체 재생" 버튼 클릭
- 플랫폼 선택 모달에서 Spotify가 기본 선택되어 있음 (곡 대부분이 Spotify)
- 사용자가 바로 재생 가능

**엣지 케이스**:
- 곡 플랫폼 정보가 없을 때 기본 플랫폼 사용
- 사용자 선택 이력이 없을 때 기본 플랫폼 사용

---

## 🧪 FE TEST → PM

감사합니다! 요구사항이 명확해졌습니다. 이제 TDD 원칙에 따라 테스트 코드를 작성하겠습니다.

테스트 작성 순서:
1. 단위 테스트 작성 (RED)
2. 통합 테스트 작성 (RED)
3. E2E 테스트 작성 (RED)

각 테스트는 한글 설명으로 작성하고, PM의 유저 시나리오를 반영하겠습니다.

---

## ✅ 테스트 작성 완료

TDD 원칙에 따라 P1 기능들의 테스트 코드를 작성했습니다:

### 작성된 테스트 파일

**단위 테스트:**
1. `src/shared/utils/__tests__/autocomplete.test.ts` - 곡 검색 자동완성 유틸리티 테스트
2. `src/shared/utils/__tests__/letterDraft.test.ts` - 편지 임시 저장 유틸리티 테스트
3. `src/shared/utils/__tests__/sortFilter.test.ts` - 정렬/필터 유틸리티 테스트
4. `src/shared/utils/__tests__/platformRecommendation.test.ts` - 플랫폼 자동 추천 테스트

**통합 테스트:**
1. `src/domains/letter/__tests__/letter-draft-integration.test.tsx` - 편지 임시 저장 통합 테스트

**E2E 테스트:**
1. `tests/e2e/p1-features.spec.ts` - P1 기능 전체 E2E 테스트

**구현 파일:**
1. `src/shared/utils/letterDraft.ts` - 편지 임시 저장 유틸리티 구현

### 테스트 커버리지

- ✅ 곡 검색 자동완성: 2글자 이상 입력 시 제안 생성, 최대 5개 제한
- ✅ 정렬/필터: 날짜순, 곡 수순, 재생 횟수순 정렬 및 이름/곡 제목/날짜 범위 필터
- ✅ 임시 저장: localStorage 기반 임시 저장 및 복구
- ✅ 플랫폼 자동 추천: 곡 분석 및 사용자 이력 기반 추천

모든 테스트는 한글 설명으로 작성되었으며, PM의 유저 시나리오를 반영했습니다.

### 다음 단계

이제 FE Engineer가 테스트를 통과하도록 기능을 구현해야 합니다 (GREEN 단계).

